openapi: 3.0.3
info:
  title: PLP - Prompt Library Protocol
  description: |
    A lightweight, RESTful specification for decoupling AI prompts from application code.
    
    PLP defines a universal Envelope for prompt data and a strict API contract for storage and retrieval.
    
    Learn more at [plp-standard](https://github.com/gorealai/plp)
  version: 1.0.0
  contact:
    name: GoReal.AI
    url: https://goreal.ai
  license:
    name: MIT
    url: https://github.com/gorealai/plp/blob/main/LICENSE

servers:
  - url: https://prompts.goreal.ai/v1
    description: Example PLP server
  - url: http://localhost:3000/v1
    description: Local development server

tags:
  - name: discovery
    description: Server discovery and capabilities
  - name: prompts
    description: Prompt CRUD operations
  - name: deploy
    description: Prompt deployment to named environments
  - name: evaluation
    description: Prompt evaluation and testing
  - name: context-store
    description: Context Store for user's private assets (images, text files)
  - name: prompt-context
    description: Prompt context mappings

security:
  - bearerAuth: []
  - {}  # Allow requests without authentication

paths:
  /.well-known/plp:
    get:
      tags:
        - discovery
      summary: Discover server capabilities
      description: |
        Returns information about the PLP server and its capabilities.
        This endpoint SHOULD NOT require authentication.
      operationId: getDiscovery
      security: []  # No auth required
      responses:
        '200':
          description: Server discovery information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Discovery'
              example:
                plp_version: "1.0"
                server: "my-plp-server"
                capabilities:
                  versioning: true
                  list: true
                  search: false
                  contextStore: true

  /prompts:
    get:
      tags:
        - prompts
      summary: List prompts
      description: |
        Returns a paginated list of prompts accessible to the authenticated user.
        Supports filtering by project and visibility.
      operationId: listPrompts
      parameters:
        - name: page
          in: query
          description: Page number (0-indexed)
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: size
          in: query
          description: Number of items per page
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: projectId
          in: query
          description: Filter by project ID
          schema:
            type: integer
        - name: visibility
          in: query
          description: Filter by visibility
          schema:
            type: string
            enum: [public, private]
      responses:
        '200':
          description: Paginated list of prompts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptListResponse'
              example:
                content:
                  - id: "marketing/welcome-email"
                    name: "Welcome Email"
                    description: "Sent on user signup"
                    visibility: "public"
                    createdAt: "2024-01-15T10:30:00Z"
                page: 0
                totalElements: 42
                totalPages: 3
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /prompts/{prompt_id}:
    get:
      tags:
        - prompts
      summary: Retrieve latest version of a prompt
      description: |
        Fetches the latest version of a prompt by its unique ID.
        If you need a specific version, use `/prompts/{prompt_id}/{version}`.
      operationId: getPrompt
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: Unique prompt identifier (e.g., "marketing/welcome-email")
          schema:
            type: string
            example: marketing/welcome-email
      responses:
        '200':
          description: Successfully retrieved prompt
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptEnvelope'
              examples:
                welcomeEmail:
                  summary: Simple text prompt
                  value:
                    id: marketing/welcome-email
                    content: "Hello {{name}}, welcome to {{product}}!"
                    meta:
                      version: "1.2.0"
                      author: shimon
                      description: Sent on user signup
                multiModal:
                  summary: Multi-modal prompt with image
                  value:
                    id: vision/product-analyzer
                    content:
                      - type: text
                        text: "Analyze this product image for {{brand}}:"
                      - type: image_url
                        image_url:
                          url: "https://example.com/product.jpg"
                          detail: high
                      - type: text
                        text: "Focus on: {{aspects}}"
                    meta:
                      version: "1.0.0"
                      author: yoad
                      description: Product image analysis prompt
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Prompt not found
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Unauthorized

    put:
      tags:
        - prompts
      summary: Create or update a prompt
      description: |
        Idempotent upsert operation. Creates a new prompt if it doesn't exist,
        or updates it if it does. Optionally stores version history (implementation-specific).
      operationId: putPrompt
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: Unique prompt identifier (e.g., "marketing/welcome-email")
          schema:
            type: string
            example: support/faq-bot
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PromptInput'
            examples:
              createPrompt:
                summary: Simple text prompt
                value:
                  content: "You are a helpful FAQ bot. Answer: {{question}}"
                  meta:
                    version: "1.0.0"
                    author: yoad
              updatePrompt:
                summary: Update existing prompt
                value:
                  content: "Updated prompt content with {{variable}}"
                  meta:
                    version: "2.0.0"
                    description: New iteration
              createMultiModal:
                summary: Multi-modal prompt with image
                value:
                  content:
                    - type: text
                      text: "Describe what you see in this image:"
                    - type: image_url
                      image_url:
                        url: "https://example.com/image.png"
                        detail: auto
                  meta:
                    version: "1.0.0"
                    author: yoad
      responses:
        '201':
          description: Successfully created new prompt
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptEnvelope'
              example:
                id: support/faq-bot
                content: "You are a helpful FAQ bot. Answer: {{question}}"
                meta:
                  version: "1.0.0"
                  author: yoad
        '200':
          description: Successfully updated existing prompt
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptEnvelope'
        '400':
          description: Invalid request (malformed JSON or missing required fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Invalid request - content field is required
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - prompts
      summary: Delete a prompt
      description: |
        Removes a prompt and all its versions permanently.
        This operation is idempotent (returns 404 if prompt doesn't exist).
      operationId: deletePrompt
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: Unique prompt identifier
          schema:
            type: string
            example: deprecated/old-prompt
      responses:
        '204':
          description: Successfully deleted (no content returned)
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Prompt not found
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /prompts/{prompt_id}/publish:
    post:
      tags:
        - prompts
      summary: Publish a prompt version
      description: |
        Publishes a specific version of a prompt, making it the active public version.
        Only the prompt owner can publish.
      operationId: publishPrompt
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: Unique prompt identifier
          schema:
            type: string
            example: marketing/welcome-email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PublishRequest'
            example:
              versionNo: 3
      responses:
        '200':
          description: Successfully published
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublishResponse'
              example:
                promptId: "marketing/welcome-email"
                versionId: 42
                versionNo: 3
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Version not found
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Not authorized to publish this prompt
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /prompts/{prompt_id}/{version}:
    get:
      tags:
        - prompts
      summary: Retrieve specific version of a prompt
      description: Fetches a specific version of a prompt by its ID and version number.
      operationId: getPromptVersion
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: Unique prompt identifier
          schema:
            type: string
            example: marketing/welcome-email
        - name: version
          in: path
          required: true
          description: Semantic version number (e.g., "1.2.0")
          schema:
            type: string
            example: "1.0.0"
      responses:
        '200':
          description: Successfully retrieved prompt version
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PromptEnvelope'
              example:
                id: marketing/welcome-email
                content: "Hello {{name}}!"
                meta:
                  version: "1.0.0"
                  author: shimon
        '404':
          description: Prompt or version not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: Version 1.0.0 not found
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Deploy Endpoint
  /prompts/{prompt_id}/deploy:
    post:
      tags:
        - deploy
      summary: Deploy a prompt version to an environment
      description: |
        Deploys a specific version of a prompt to a named environment (e.g., staging, production).
        This pins that version as the active version for the given environment.
      operationId: deployPrompt
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: The prompt identifier
          schema:
            type: string
            example: marketing/welcome-email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeployRequest'
            example:
              versionNo: 3
              environment: production
      responses:
        '200':
          description: Successfully deployed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeployResponse'
              example:
                promptId: "marketing/welcome-email"
                versionNo: 3
                environment: "production"
                deployedAt: "2025-06-15T14:30:00Z"
        '400':
          description: Invalid request (unknown environment or version)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Prompt or version not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Evaluation Endpoints
  /prompts/{prompt_id}/eval:
    post:
      tags:
        - evaluation
      summary: Run an evaluation against a prompt
      description: |
        Runs an evaluation suite against a prompt. The eval content is provided as
        YAML (the .eval file format) and optionally references a saved dataset.
        Returns structured results with pass/fail status for each test and assertion.
      operationId: runEval
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: The prompt identifier
          schema:
            type: string
            example: marketing/welcome-email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RunEvalRequest'
      responses:
        '200':
          description: Evaluation completed (may contain failures)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvalSuiteResult'
        '400':
          description: Invalid eval content or configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /prompts/{prompt_id}/eval/datasets/{dataset_id}:
    put:
      tags:
        - evaluation
      summary: Save or update an eval dataset
      description: |
        Saves a dataset containing test cases with golden responses for evaluation.
        Creates the dataset if it doesn't exist, or replaces it if it does.
      operationId: saveEvalDataset
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: The prompt identifier
          schema:
            type: string
        - name: dataset_id
          in: path
          required: true
          description: The dataset identifier
          schema:
            type: string
            example: family-scenarios
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EvalDataset'
      responses:
        '200':
          description: Dataset updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvalDataset'
        '201':
          description: Dataset created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvalDataset'
        '400':
          description: Invalid dataset format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      tags:
        - evaluation
      summary: Retrieve an eval dataset
      description: |
        Retrieves a saved evaluation dataset by ID.
      operationId: getEvalDataset
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: The prompt identifier
          schema:
            type: string
        - name: dataset_id
          in: path
          required: true
          description: The dataset identifier
          schema:
            type: string
            example: family-scenarios
      responses:
        '200':
          description: Dataset retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvalDataset'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Prompt or dataset not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Context Store Endpoints
  /context-store:
    get:
      tags:
        - context-store
      summary: List user's Context Store assets
      description: |
        Returns all assets in the authenticated user's Context Store.
        Optionally filter by project ID.
      operationId: listContextStoreAssets
      parameters:
        - name: projectId
          in: query
          required: false
          description: Filter assets by project ID
          schema:
            type: integer
      responses:
        '200':
          description: List of context store assets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ContextStoreAsset'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - context-store
      summary: Upload a new asset to Context Store
      description: |
        Upload an image or text file to the authenticated user's Context Store.
        Supported types: images (png, jpg, gif, webp) and text (txt, md, json, yaml, xml).
      operationId: uploadContextStoreAsset
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - assetId
                - file
              properties:
                assetId:
                  type: string
                  description: Unique asset identifier (1-64 alphanumeric, hyphens, underscores)
                  pattern: '^[a-zA-Z0-9_-]{1,64}$'
                  example: logo-v2
                projectId:
                  type: integer
                  description: Optional project to scope the asset
                file:
                  type: string
                  format: binary
                  description: The file to upload
      responses:
        '201':
          description: Asset uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContextStoreAsset'
        '400':
          description: Invalid request (bad asset ID, unsupported file type, or file too large)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Asset with this ID already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /context-store/{asset_id}:
    get:
      tags:
        - context-store
      summary: Get asset content
      description: |
        Retrieves the content of an asset as a base64 data URL.
        For images: data:image/png;base64,...
        For text: data:text/plain;base64,...
      operationId: getContextStoreAsset
      parameters:
        - name: asset_id
          in: path
          required: true
          description: The asset identifier
          schema:
            type: string
            example: logo-v2
      responses:
        '200':
          description: Asset content as data URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetContent'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Asset not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - context-store
      summary: Delete an asset
      description: |
        Permanently removes an asset from the Context Store.
        Will fail if the asset is in use by any prompt context mappings.
      operationId: deleteContextStoreAsset
      parameters:
        - name: asset_id
          in: path
          required: true
          description: The asset identifier
          schema:
            type: string
            example: logo-v2
      responses:
        '204':
          description: Asset deleted successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Asset not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Asset is in use by prompt context mappings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /context-store/usage:
    get:
      tags:
        - context-store
      summary: Get storage usage
      description: Returns storage usage statistics for the authenticated user.
      operationId: getContextStoreUsage
      responses:
        '200':
          description: Storage usage statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StorageUsage'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Prompt Context Endpoints
  /prompts/{prompt_id}/context:
    get:
      tags:
        - prompt-context
      summary: List context mappings for a prompt
      description: |
        Returns all context mappings configured for a prompt.
        These map context names (used in #context() syntax) to Context Store assets.
      operationId: listPromptContextMappings
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: The prompt identifier
          schema:
            type: string
      responses:
        '200':
          description: List of context mappings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ContextMapping'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      tags:
        - prompt-context
      summary: Add or update a context mapping
      description: |
        Maps a context name to a Context Store asset for this prompt.
        If the context name already exists, updates it to point to the new asset.
      operationId: addPromptContextMapping
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: The prompt identifier
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddContextMappingInput'
      responses:
        '201':
          description: Context mapping created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContextMapping'
        '200':
          description: Context mapping updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContextMapping'
        '400':
          description: Invalid context name format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Prompt or asset not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /prompts/{prompt_id}/context/{context_name}:
    delete:
      tags:
        - prompt-context
      summary: Remove a context mapping
      description: Removes a context mapping from a prompt.
      operationId: removePromptContextMapping
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: The prompt identifier
          schema:
            type: string
        - name: context_name
          in: path
          required: true
          description: The context name to remove
          schema:
            type: string
      responses:
        '204':
          description: Context mapping removed
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Prompt or context mapping not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /prompts/{prompt_id}/context/_resolve:
    post:
      tags:
        - prompt-context
      summary: Resolve context mappings to content
      description: |
        Resolves context mappings to actual content (base64 data URLs).
        This is called during template rendering to get the content for #context() references.
      operationId: resolvePromptContext
      parameters:
        - name: prompt_id
          in: path
          required: true
          description: The prompt identifier
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResolveContextInput'
      responses:
        '200':
          description: Resolved context content
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  $ref: '#/components/schemas/ResolvedContext'
              example:
                hero-image:
                  contextName: hero-image
                  assetId: logo-v2
                  mimeType: image/png
                  dataUrl: "data:image/png;base64,iVBORw0KGgo..."
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Prompt not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      description: Optional API key for authentication (Bearer token)

  schemas:
    # Multi-modal Content Types
    TextContent:
      type: object
      required:
        - type
        - text
      properties:
        type:
          type: string
          enum: [text]
          description: Content type identifier
        text:
          type: string
          description: The text content (can include variables like {{name}})
          example: "Hello {{name}}, welcome to {{product}}!"

    ImageUrl:
      type: object
      required:
        - url
      properties:
        url:
          type: string
          description: Image URL or base64 data URI
          example: "https://example.com/image.png"
        detail:
          type: string
          enum: [auto, low, high]
          description: Image detail level for vision models
          default: auto

    ImageContent:
      type: object
      required:
        - type
        - image_url
      properties:
        type:
          type: string
          enum: [image_url]
          description: Content type identifier
        image_url:
          $ref: '#/components/schemas/ImageUrl'

    ContentPart:
      oneOf:
        - $ref: '#/components/schemas/TextContent'
        - $ref: '#/components/schemas/ImageContent'
      description: A single content part (text or image)

    PromptContent:
      oneOf:
        - type: string
          description: Simple string content (backwards compatible)
        - type: array
          items:
            $ref: '#/components/schemas/ContentPart'
          description: Multi-modal content array
      description: |
        Prompt content - either a simple string (backwards compatible)
        or an array of content parts for multi-modal prompts.

    PromptEnvelope:
      type: object
      required:
        - id
        - content
        - meta
      properties:
        id:
          type: string
          description: Unique identifier for the prompt (supports namespacing with "/")
          example: marketing/welcome-email
          pattern: '^[a-zA-Z0-9/_-]+$'
        content:
          $ref: '#/components/schemas/PromptContent'
        meta:
          type: object
          description: Metadata container (must exist, can be empty)
          properties:
            version:
              type: string
              description: Semantic version (e.g., "1.2.0")
              example: "1.2.0"
            author:
              type: string
              description: Creator identifier
              example: shimon
            description:
              type: string
              description: Human-readable description
              example: Sent on user signup
            model_config:
              type: object
              description: Optional LLM configuration hints
              additionalProperties: true
              example:
                temperature: 0.7
                max_tokens: 500
          additionalProperties: true

    PromptInput:
      type: object
      required:
        - content
        - meta
      properties:
        content:
          $ref: '#/components/schemas/PromptContent'
        meta:
          type: object
          description: Metadata container (can be empty object {})
          additionalProperties: true
          example:
            version: "1.0.0"
            author: yoad

    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Human-readable error message
          example: Prompt not found

    Discovery:
      type: object
      required:
        - plp_version
        - capabilities
      properties:
        plp_version:
          type: string
          description: The PLP protocol version supported by this server
          example: "1.0"
        server:
          type: string
          description: Optional server implementation name
          example: "my-plp-server"
        capabilities:
          type: object
          required:
            - versioning
            - list
            - search
          properties:
            versioning:
              type: boolean
              description: Whether the server maintains version history
              example: true
            list:
              type: boolean
              description: Whether listing prompts is supported
              example: false
            search:
              type: boolean
              description: Whether search is supported
              example: false
            contextStore:
              type: boolean
              description: Whether Context Store is supported
              example: true
            deploy:
              type: boolean
              description: Whether prompt deployment to environments is supported
              example: true
            evaluation:
              type: boolean
              description: Whether prompt evaluation/testing is supported
              example: true
          additionalProperties: true

    # Context Store Schemas
    ContextStoreAsset:
      type: object
      required:
        - id
        - assetId
        - mimeType
        - fileSize
        - plpReference
        - createdAt
      properties:
        id:
          type: integer
          description: Internal database ID
          example: 42
        assetId:
          type: string
          description: Unique asset identifier
          example: logo-v2
        mimeType:
          type: string
          description: MIME type of the asset
          example: image/png
        fileSize:
          type: integer
          format: int64
          description: File size in bytes
          example: 102400
        plpReference:
          type: string
          description: PLP reference URL (plp://asset-id)
          example: "plp://logo-v2"
        projectId:
          type: integer
          description: Project ID if scoped to a project
          nullable: true
          example: 5
        createdAt:
          type: string
          format: date-time
          description: When the asset was created
          example: "2024-01-15T10:30:00Z"

    AssetContent:
      type: object
      required:
        - assetId
        - mimeType
        - dataUrl
      properties:
        assetId:
          type: string
          description: Asset identifier
          example: logo-v2
        mimeType:
          type: string
          description: MIME type of the content
          example: image/png
        dataUrl:
          type: string
          description: Base64 data URL containing the asset content
          example: "data:image/png;base64,iVBORw0KGgo..."

    StorageUsage:
      type: object
      required:
        - bytesUsed
        - assetCount
      properties:
        bytesUsed:
          type: integer
          format: int64
          description: Total bytes used by all assets
          example: 5242880
        assetCount:
          type: integer
          format: int64
          description: Number of assets in the Context Store
          example: 12

    # Prompt Context Schemas
    ContextMapping:
      type: object
      required:
        - id
        - contextName
        - assetId
        - mimeType
        - plpReference
        - createdAt
      properties:
        id:
          type: integer
          description: Internal database ID
          example: 7
        contextName:
          type: string
          description: Context name used in #context() syntax
          example: hero-image
        assetId:
          type: string
          description: ID of the linked Context Store asset
          example: logo-v2
        mimeType:
          type: string
          description: MIME type of the linked asset
          example: image/png
        plpReference:
          type: string
          description: PLP reference URL
          example: "plp://logo-v2"
        createdAt:
          type: string
          format: date-time
          description: When the mapping was created
          example: "2024-01-15T10:30:00Z"

    AddContextMappingInput:
      type: object
      required:
        - contextName
        - assetId
      properties:
        contextName:
          type: string
          description: Context name to use in #context() syntax
          pattern: '^[a-zA-Z0-9_.-]{1,128}$'
          example: hero-image
        assetId:
          type: string
          description: ID of the Context Store asset to link
          example: logo-v2

    ResolveContextInput:
      type: object
      properties:
        contextNames:
          type: array
          items:
            type: string
          description: Specific context names to resolve (null = all)
          nullable: true
          example: ["hero-image", "readme"]

    ResolvedContext:
      type: object
      required:
        - contextName
        - assetId
        - mimeType
      properties:
        contextName:
          type: string
          description: The context name
          example: hero-image
        assetId:
          type: string
          description: The resolved asset ID
          example: logo-v2
        mimeType:
          type: string
          description: MIME type of the content
          example: image/png
        dataUrl:
          type: string
          description: Base64 data URL containing the content (may be null if unavailable)
          nullable: true
          example: "data:image/png;base64,iVBORw0KGgo..."

    # Prompt List Schemas
    PromptListResponse:
      type: object
      required:
        - content
        - page
        - totalElements
        - totalPages
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/PromptSummary'
          description: List of prompt summaries
        page:
          type: integer
          description: Current page number (0-indexed)
          example: 0
        totalElements:
          type: integer
          description: Total number of prompts matching the query
          example: 42
        totalPages:
          type: integer
          description: Total number of pages
          example: 3

    PromptSummary:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
          description: Unique prompt identifier (slug or name)
          example: marketing/welcome-email
        name:
          type: string
          description: Human-readable prompt name
          example: Welcome Email
        description:
          type: string
          description: Optional prompt description
          nullable: true
          example: Sent on user signup
        visibility:
          type: string
          enum: [public, private]
          description: Prompt visibility
          example: public
        createdAt:
          type: string
          format: date-time
          description: When the prompt was created
          example: "2024-01-15T10:30:00Z"

    # Publish Schemas
    PublishRequest:
      type: object
      required:
        - versionNo
      properties:
        versionNo:
          type: integer
          description: The version number to publish
          minimum: 1
          example: 3

    PublishResponse:
      type: object
      required:
        - promptId
        - versionNo
      properties:
        promptId:
          type: string
          description: The prompt identifier
          example: marketing/welcome-email
        versionId:
          type: integer
          description: Internal version record ID
          example: 42
        versionNo:
          type: integer
          description: The published version number
          example: 3

    # Deploy Schemas
    DeployRequest:
      type: object
      required:
        - versionNo
        - environment
      properties:
        versionNo:
          type: integer
          description: The version number to deploy
          minimum: 1
          example: 3
        environment:
          type: string
          description: Target environment name (e.g., staging, production)
          example: production

    DeployResponse:
      type: object
      required:
        - promptId
        - versionNo
        - environment
        - deployedAt
      properties:
        promptId:
          type: string
          description: The prompt identifier
          example: marketing/welcome-email
        versionNo:
          type: integer
          description: The deployed version number
          example: 3
        environment:
          type: string
          description: The target environment
          example: production
        deployedAt:
          type: string
          format: date-time
          description: When the deployment occurred
          example: "2025-06-15T14:30:00Z"

    # Evaluation Schemas
    RunEvalRequest:
      type: object
      required:
        - evalContent
      properties:
        evalContent:
          type: string
          description: The .eval file content (YAML format)
        versionNo:
          type: integer
          description: Prompt version to evaluate (default latest)
          minimum: 1
        datasetId:
          type: string
          description: Reference to a saved dataset for test inputs

    EvalSuiteResult:
      type: object
      required:
        - suiteName
        - status
        - tests
        - summary
      properties:
        suiteName:
          type: string
          description: Name of the eval suite
          example: Smoke Tests
        status:
          type: string
          enum: [pass, fail, error]
          description: Overall suite status
        tests:
          type: array
          items:
            $ref: '#/components/schemas/EvalTestResult'
        summary:
          type: object
          required:
            - total
            - passed
            - failed
            - durationMs
          properties:
            total:
              type: integer
              description: Total number of tests
              example: 5
            passed:
              type: integer
              description: Number of passed tests
              example: 4
            failed:
              type: integer
              description: Number of failed tests
              example: 1
            durationMs:
              type: number
              description: Total duration in milliseconds
              example: 3200

    EvalTestResult:
      type: object
      required:
        - name
        - status
        - assertions
      properties:
        name:
          type: string
          description: Test name
          example: renders family-friendly rules
        status:
          type: string
          enum: [pass, fail, error]
          description: Test status
        assertions:
          type: array
          items:
            $ref: '#/components/schemas/AssertionResult'
        durationMs:
          type: number
          description: Test duration in milliseconds
        error:
          type: string
          description: Error message if status is error

    AssertionResult:
      type: object
      required:
        - operator
        - status
      properties:
        operator:
          type: string
          description: The assertion operator used
          example: contains
        status:
          type: string
          enum: [pass, fail, error]
          description: Assertion status
        expected:
          type: string
          description: Expected value
        actual:
          type: string
          description: Actual value
        message:
          type: string
          description: Human-readable result message

    EvalDataset:
      type: object
      required:
        - id
        - cases
      properties:
        id:
          type: string
          description: Unique dataset identifier
          example: family-scenarios
        description:
          type: string
          description: Human-readable description
        cases:
          type: array
          items:
            $ref: '#/components/schemas/EvalDatasetCase'
          description: Test cases with inputs and optional expected outputs

    EvalDatasetCase:
      type: object
      required:
        - name
        - input
      properties:
        name:
          type: string
          description: Test case name
          example: family-comedy
        input:
          type: object
          additionalProperties: true
          description: Prompt variables as key-value pairs
        expected:
          type: string
          description: Golden/reference response
        model:
          type: string
          description: Model used to generate the golden response
        metadata:
          type: object
          additionalProperties: true
          description: Additional metadata (tokens, latency, etc.)
