{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/gorealai/plp/spec/plp-schema.json",
  "title": "PLP Prompt Envelope",
  "description": "JSON Schema for validating PLP (Prompt Library Protocol) prompt objects",
  "type": "object",
  "required": ["id", "content", "meta"],
  "definitions": {
    "TextContent": {
      "type": "object",
      "required": ["type", "text"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["text"],
          "description": "Content type identifier"
        },
        "text": {
          "type": "string",
          "description": "The text content (can include variables like {{name}})"
        }
      },
      "additionalProperties": false
    },
    "ImageUrl": {
      "type": "object",
      "required": ["url"],
      "properties": {
        "url": {
          "type": "string",
          "description": "Image URL or base64 data URI"
        },
        "detail": {
          "type": "string",
          "enum": ["auto", "low", "high"],
          "description": "Image detail level for vision models",
          "default": "auto"
        }
      },
      "additionalProperties": false
    },
    "ImageContent": {
      "type": "object",
      "required": ["type", "image_url"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["image_url"],
          "description": "Content type identifier"
        },
        "image_url": {
          "$ref": "#/definitions/ImageUrl"
        }
      },
      "additionalProperties": false
    },
    "ContentPart": {
      "oneOf": [
        { "$ref": "#/definitions/TextContent" },
        { "$ref": "#/definitions/ImageContent" }
      ],
      "description": "A single content part (text or image)"
    }
  },
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for the prompt (supports namespacing with '/')",
      "pattern": "^[a-zA-Z0-9_-]+(/[a-zA-Z0-9_-]+)*$",
      "not": {
        "pattern": "\\.\\."
      },
      "minLength": 1,
      "maxLength": 256,
      "examples": [
        "marketing/welcome-email",
        "support/faq-bot",
        "product/feature-announcement"
      ]
    },
    "content": {
      "oneOf": [
        {
          "type": "string",
          "description": "Simple string content (backwards compatible)"
        },
        {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ContentPart"
          },
          "minItems": 1,
          "description": "Multi-modal content array"
        }
      ],
      "description": "Prompt content - either a simple string or an array of content parts"
    },
    "meta": {
      "type": "object",
      "description": "Metadata container (must exist, can be empty)",
      "properties": {
        "version": {
          "type": "string",
          "description": "Semantic version (e.g., '1.2.0')",
          "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.-]+)?(\\+[a-zA-Z0-9.-]+)?$",
          "examples": ["1.0.0", "2.1.3", "1.0.0-beta", "1.2.0+build.123"]
        },
        "author": {
          "type": "string",
          "description": "Creator identifier",
          "examples": ["shimon", "yoad", "team@goreal.ai"]
        },
        "description": {
          "type": "string",
          "description": "Human-readable description",
          "examples": [
            "Sent on user signup",
            "FAQ response bot",
            "Product announcement email"
          ]
        },
        "model_config": {
          "type": "object",
          "description": "Optional LLM configuration hints",
          "properties": {
            "temperature": {
              "type": "number",
              "minimum": 0,
              "maximum": 2,
              "description": "Sampling temperature"
            },
            "max_tokens": {
              "type": "integer",
              "minimum": 1,
              "description": "Maximum tokens to generate"
            },
            "top_p": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Nucleus sampling parameter"
            },
            "frequency_penalty": {
              "type": "number",
              "minimum": -2,
              "maximum": 2,
              "description": "Frequency penalty"
            },
            "presence_penalty": {
              "type": "number",
              "minimum": -2,
              "maximum": 2,
              "description": "Presence penalty"
            }
          },
          "additionalProperties": true
        },
        "tags": {
          "type": "array",
          "description": "Optional tags for categorization",
          "items": {
            "type": "string"
          },
          "examples": [["marketing", "email"], ["support", "automated"]]
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of creation"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of last update"
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "id": "marketing/welcome-email",
      "content": "Hello {{name}}, welcome to {{product}}!",
      "meta": {
        "version": "1.2.0",
        "author": "shimon",
        "description": "Sent on user signup",
        "model_config": {
          "temperature": 0.7,
          "max_tokens": 500
        }
      }
    },
    {
      "id": "support/faq-bot",
      "content": "You are a helpful FAQ bot. Answer: {{question}}",
      "meta": {
        "version": "1.0.0",
        "author": "yoad",
        "tags": ["support", "automated"]
      }
    },
    {
      "id": "simple/prompt",
      "content": "Just a simple prompt",
      "meta": {}
    },
    {
      "id": "vision/product-analyzer",
      "content": [
        {
          "type": "text",
          "text": "Analyze this product image for {{brand}}:"
        },
        {
          "type": "image_url",
          "image_url": {
            "url": "https://example.com/product.jpg",
            "detail": "high"
          }
        },
        {
          "type": "text",
          "text": "Focus on: {{aspects}}"
        }
      ],
      "meta": {
        "version": "1.0.0",
        "author": "yoad",
        "description": "Multi-modal product analysis prompt"
      }
    }
  ]
}
